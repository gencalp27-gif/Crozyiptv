<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Croz IPTV Pro - M3U</title>
<style>
body { font-family:sans-serif; background:#111; color:#fff; display:flex; flex-direction:column; align-items:center; padding:1rem; }
input, button { padding:0.5rem; margin:0.3rem 0; border-radius:5px; border:none; }
input { width:90%; max-width:350px; }
button { background:#e50914; color:#fff; cursor:pointer; }
video { margin-top:1rem; border-radius:10px; width:90%; max-width:600px; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:0.3rem; margin-top:1rem; width:90%; }
.card { background:#222; padding:0.5rem; border-radius:5px; cursor:pointer; text-align:center; font-size:0.9rem; }
.card:hover { background:#333; }
</style>
</head>
<body>

<h2>Croz IPTV Pro - M3U</h2>

<input type="url" id="m3uUrl" placeholder="M3U URL girin">
<button id="loadBtn">Kanalları Yükle</button>

<video id="player" controls></video>
<div class="grid" id="channelGrid"></div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const player = document.getElementById('player');
const grid = document.getElementById('channelGrid');

document.getElementById('loadBtn').addEventListener('click', async () => {
    const url = document.getElementById('m3uUrl').value.trim();
    if(!url){ alert("M3U URL girin!"); return; }

    try {
        const corsProxy = "https://api.allorigins.win/raw?url=";
        const res = await fetch(corsProxy + encodeURIComponent(url));
        const text = await res.text();

        // M3U parse
        const lines = text.split('\n');
        const channels = [];
        let current = {};

        lines.forEach(line => {
            line = line.trim();
            if(line.startsWith('#EXTINF:')){
                const nameMatch = line.match(/,(.*)$/);
                current.name = nameMatch ? nameMatch[1] : "Bilinmeyen";
            } else if(line.startsWith('http')){
                current.url = line;
                channels.push({...current});
                current = {};
            }
        });

        // Grid oluştur
        grid.innerHTML = "";
        channels.forEach(ch => {
            const card = document.createElement('div');
            card.className = "card";
            card.innerText = ch.name;
            card.onclick = () => playStream(ch.url);
            grid.appendChild(card);
        });

        alert("Kanallar yüklendi! Bir kanal seçip izleyebilirsiniz.");

    } catch(err){
        console.error(err);
        alert("M3U yükleme hatası!");
    }
});

function playStream(url){
    if(Hls.isSupported()){
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(player);
        hls.on(Hls.Events.MANIFEST_PARSED, ()=>player.play());
        hls.on(Hls.Events.ERROR,(e,d)=>console.error("HLS Error:",d));
    } else if(player.canPlayType('application/vnd.apple.mpegurl')){
        player.src = url;
        player.play();
    } else {
        alert("HLS desteklenmiyor!");
    }
}
</script>

</body>
</html>