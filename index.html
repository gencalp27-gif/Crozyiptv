<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Croz IPTV Pro</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{--primary:#e50914;--primary-dark:#b80710;--bg:#111;--card:#1a1a1a;--text:#fff;--accent:#00a8ff;--success:#00d46a;}
body{background:var(--bg);color:var(--text);font-family:sans-serif;margin:0;padding:0;}
.container{max-width:1200px;margin:auto;padding:1rem;}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;}
.header h1{color:var(--primary);}
input,button,select{padding:0.5rem 1rem;border-radius:8px;border:none;margin-bottom:0.5rem;font-size:1rem;}
button{background:var(--primary);color:#fff;cursor:pointer;transition:all 0.3s;}
button:hover{background:var(--primary-dark);}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:0.5rem;margin-top:1rem;}
.card{background:var(--card);border-radius:12px;padding:0.5rem;cursor:pointer;transition:all 0.3s;position:relative;text-align:center;}
.card:hover{transform:translateY(-3px);border:2px solid var(--primary);}
.card.playing{border:2px solid var(--accent);}
.card img{width:100%;height:100px;object-fit:cover;border-radius:8px;}
.favorite{position:absolute;top:5px;right:5px;font-size:1.2rem;cursor:pointer;}
#playerContainer{margin-top:1rem;position:relative;}
video{width:100%;border-radius:12px;background:#000;}
#nowPlaying{margin-top:0.5rem;text-align:center;color:var(--accent);}
.message{padding:0.5rem 1rem;border-radius:8px;margin-top:0.5rem;text-align:center;}
.error{background:#e50914;color:#fff;}
.success{background:var(--success);color:#fff;}
@media(max-width:768px){.grid{grid-template-columns:1fr 1fr;}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1><i class="fas fa-tv"></i> Croz IPTV Pro</h1>
  </div>

  <input type="text" id="username" placeholder="Xtream Username">
  <input type="text" id="password" placeholder="Xtream Password">
  <input type="url" id="xtreamUrl" placeholder="Xtream URL / M3U">
  <button id="loginBtn">Giriş Yap</button>
  <div id="msg"></div>

  <input type="text" id="searchInput" placeholder="Kanal ara...">
  <select id="categoryFilter">
    <option value="">Tüm Kategoriler</option>
    <option value="live">Canlı</option>
    <option value="movie">Film</option>
    <option value="series">Dizi</option>
    <option value="sport">Spor</option>
    <option value="music">Müzik</option>
  </select>

  <div id="playerContainer">
    <video id="player" controls autoplay></video>
    <div id="nowPlaying">Şu an: -</div>
  </div>

  <h3>Kanallar</h3>
  <div class="grid" id="channelGrid"></div>
</div>

<script>
let player=document.getElementById('player');
let channels=[],filteredChannels=[],currentIndex=0;

// Mesaj göster
function showMessage(text,type){const msg=document.getElementById('msg');msg.textContent=text;msg.className='message '+type;setTimeout(()=>{msg.textContent='';msg.className='';},4000);}

// Login
document.getElementById('loginBtn').addEventListener('click',async()=>{
  const username=document.getElementById('username').value;
  const password=document.getElementById('password').value;
  const url=document.getElementById('xtreamUrl').value;
  if(!url){showMessage("URL girin!","error"); return;}
  try{
    const res=await fetch('https://senin-sunucu.com/login',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({type:'xtream',username,password,url})
    });
    const text=await res.text();
    channels=[]; let current={};
    text.split('\n').forEach(line=>{
      line=line.trim();
      if(line.startsWith('#EXTINF:')){
        const nameMatch=line.match(/,(.*)$/);
        current.name=nameMatch?nameMatch[1]:"Bilinmeyen";
        const lower=current.name.toLowerCase();
        if(lower.includes('film')||lower.includes('movie'))current.category='movie';
        else if(lower.includes('dizi')||lower.includes('series'))current.category='series';
        else if(lower.includes('spor')||lower.includes('sport'))current.category='sport';
        else if(lower.includes('müzik')||lower.includes('music'))current.category='music';
        else current.category='live';
      }else if(line.startsWith('http')){
        current.url=line; channels.push({...current}); current={};
      }
    });
    filteredChannels=channels.slice(); renderChannels(); showMessage("Kanallar yüklendi!","success");
  }catch(err){console.error(err);showMessage("Login hatası: "+err.message,"error");}
});

// Render
function renderChannels(){
  const query=document.getElementById('searchInput').value.toLowerCase();
  const cat=document.getElementById('categoryFilter').value;
  filteredChannels=channels.filter(ch=>(ch.name.toLowerCase().includes(query))&&(cat?ch.category===cat:true));
  const grid=document.getElementById('channelGrid'); grid.innerHTML="";
  if(filteredChannels.length===0){grid.innerHTML="<div style='text-align:center;color:#ccc;padding:1rem;'>Kanal bulunamadı</div>";return;}
  filteredChannels.forEach((ch,i)=>{
    const card=document.createElement('div'); card.className='card'; card.innerText=ch.name;
    card.onclick=()=>playStream(ch.url); grid.appendChild(card);
  });
}

// Play MPG
function playStream(url){
  player.src=`https://senin-sunucu.com/stream?url=${encodeURIComponent(url)}`;
  player.play().catch(e=>console.error(e));
  document.getElementById('nowPlaying').textContent=`Şu an: ${url}`;
}

// Search / filter
document.getElementById('searchInput').addEventListener('input',renderChannels);
document.getElementById('categoryFilter').addEventListener('change',renderChannels);
</script>
</body>
</html>