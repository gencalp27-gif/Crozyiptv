<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Croz IPTV â€” Offline Pro Player</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
  --bg:#0b0d10; --panel:#0f1417; --muted:#94a3b8; --card:#101418;
  --accent:#e50914; --accent-2:#00a8ff; --success:#00d46a; --radius:12px;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
body{background:linear-gradient(180deg,#050607 0%,var(--bg) 100%);color:#e6eef6; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
.app{max-width:1100px;margin:24px auto;padding:20px;}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px;}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#ff7a7a);display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 6px 18px rgba(0,0,0,0.6);}
.title{font-weight:700;font-size:1.15rem}
.sub{color:var(--muted);font-size:.9rem;margin-top:2px}

.controls{display:grid;grid-template-columns:1fr 160px;gap:12px;margin-bottom:14px;}
@media (max-width:700px){ .controls{grid-template-columns:1fr; } }

.card{background:var(--panel);border-radius:var(--radius);padding:14px;box-shadow: 0 6px 20px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03);}
.upload-row{display:flex;gap:10px;align-items:center;}
.file-input{display:flex;gap:8px;align-items:center;width:100%}
.input, textarea, select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:var(--glass); color:inherit; font-size:0.95rem; }
.smallbtn{padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:#fff;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
.smallbtn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
.file-label{cursor:pointer;display:inline-flex;align-items:center;gap:8px;font-weight:600}

.tools{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px;}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:12px;margin-top:14px}
@media (max-width:640px){ .grid{grid-template-columns:repeat(2,1fr)} }

.channel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015)); padding:10px;border-radius:12px;cursor:pointer;display:flex;gap:10px;align-items:center;border:1px solid rgba(255,255,255,0.02);transition:all .16s}
.channel:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(0,0,0,0.6);border-color:rgba(255,255,255,0.04)}
.logo-thumb{width:84px;height:56px;border-radius:8px;background:#071018;display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0}
.logo-thumb img{width:100%;height:100%;object-fit:cover}
.info{flex:1;min-width:0}
.name{font-weight:700;font-size:0.95rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.meta{color:var(--muted);font-size:0.85rem;margin-top:6px}
.badges{display:flex;gap:8px;align-items:center;margin-left:8px}
.badge{font-size:0.8rem;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);color:var(--muted);border:1px solid rgba(255,255,255,0.02)}

.nowplaying{margin-top:14px;display:flex;align-items:center;justify-content:space-between;gap:10px}
.nowplaying .title{font-weight:700}
.actions{display:flex;gap:8px;align-items:center}

.favorite{font-size:18px;cursor:pointer;color:rgba(255,255,255,0.6)}
.favorite.active{color:var(--accent)}

.footer-note{color:var(--muted);font-size:0.85rem;margin-top:14px;text-align:center}

/* empty state */
.empty{padding:28px;border-radius:12px;border:1px dashed rgba(255,255,255,0.03);text-align:center;color:var(--muted)}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="brand">
      <div class="logo"><i class="fas fa-broadcast-tower"></i></div>
      <div>
        <div class="title">Croz IPTV Pro</div>
        <div class="sub">Offline M3U yÃ¼kleyip yerel veya native oynatÄ±cÄ± ile izle</div>
      </div>
    </div>

    <div style="display:flex;gap:8px;align-items:center">
      <button id="themeToggle" class="smallbtn secondary" title="Tema deÄŸiÅŸtir"><i class="fas fa-adjust"></i></button>
      <button id="exportBtn" class="smallbtn" title="Playlist dÄ±ÅŸa aktar"><i class="fas fa-file-export"></i> DÄ±ÅŸa Aktar</button>
    </div>
  </div>

  <!-- controls -->
  <div class="controls">
    <div class="card">
      <div style="font-weight:700;margin-bottom:8px">M3U yÃ¼kle</div>

      <div class="upload-row">
        <label class="file-label" for="fileInput"><i class="fas fa-file-upload"></i> Dosyadan yÃ¼kle</label>
        <input id="fileInput" type="file" accept=".m3u,.txt" style="display:none">
      </div>

      <div style="margin-top:10px">
        <div style="font-weight:600;margin-bottom:6px">Ya da M3U iÃ§eriÄŸini yapÄ±ÅŸtÄ±r</div>
        <textarea id="pasteArea" class="input" rows="5" placeholder="#EXTM3U satÄ±rlarÄ±nÄ± buraya yapÄ±ÅŸtÄ±r veya dosya yÃ¼kle"></textarea>
      </div>

      <div class="tools">
        <button id="parseBtn" class="smallbtn"><i class="fas fa-magnifying-glass"></i> AyrÄ±ÅŸtÄ±r</button>
        <button id="clearBtn" class="smallbtn secondary"><i class="fas fa-trash"></i> Temizle</button>
      </div>

      <div style="margin-top:8px;color:var(--muted);font-size:0.9rem">Not: Web Ã¼zerinden doÄŸrudan M3U URL fetch CORS nedeniyle gÃ¼venilmez. Dosya yÃ¼kle veya iÃ§eriÄŸi yapÄ±ÅŸtÄ±r.</div>
    </div>

    <div class="card">
      <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div style="min-width:0">
          <div style="font-weight:700">Filtre & Ara</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="search" class="input" placeholder="Kanal adÄ± ara..." />
            <select id="category" class="input" style="width:160px">
              <option value="">TÃ¼m Kategoriler</option>
            </select>
          </div>
        </div>
      </div>

      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <select id="sort" class="input" style="width:160px">
          <option value="">SÄ±rala</option>
          <option value="name">Alfabetik</option>
          <option value="group">Gruba GÃ¶re</option>
        </select>
        <button id="showFavs" class="smallbtn secondary"><i class="fas fa-heart"></i> Favoriler</button>
        <button id="resetView" class="smallbtn secondary"><i class="fas fa-list"></i> TÃ¼mÃ¼nÃ¼ GÃ¶ster</button>
      </div>

      <div class="nowplaying" style="margin-top:10px">
        <div>
          <div style="font-size:0.85rem;color:var(--muted)">Åžu an</div>
          <div id="nowTitle" class="title">-</div>
        </div>
        <div class="actions">
          <button id="openNative" class="smallbtn secondary"><i class="fas fa-external-link-alt"></i> Native AÃ§</button>
          <button id="playInline" class="smallbtn"><i class="fas fa-play"></i> TarayÄ±cÄ±da Oyna</button>
        </div>
      </div>
    </div>
  </div>

  <!-- channels -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700">Kanallar</div>
      <div style="color:var(--muted);font-size:0.9rem" id="countLabel">0 kanal</div>
    </div>

    <div id="channelContainer" style="margin-top:12px">
      <div class="empty">HenÃ¼z kanal yok â€” M3U yÃ¼kle veya iÃ§eriÄŸi yapÄ±ÅŸtÄ±rÄ±p "AyrÄ±ÅŸtÄ±r" butonuna bas.</div>
    </div>
  </div>

  <div class="footer-note">Croz IPTV Pro â€” Dosya tabanlÄ± offline kullanÄ±m. GitHub Pagesâ€™de Ã§alÄ±ÅŸÄ±r. Ä°Ã§erik paylaÅŸÄ±mÄ±na dikkat et.</div>
</div>

<script>
/* Croz IPTV - Offline Pro Player
   - Dosyadan M3U yÃ¼kle veya iÃ§eriÄŸi yapÄ±ÅŸtÄ±r
   - #EXTINF parsing: tvg-logo / group-title / name
   - Favoriler localStorage'da
   - Kanal tÄ±klayÄ±nca window.location.href aÃ§ar (native player tercih edilir)
*/

const fileInput = document.getElementById('fileInput');
const pasteArea = document.getElementById('pasteArea');
const parseBtn = document.getElementById('parseBtn');
const clearBtn = document.getElementById('clearBtn');
const channelContainer = document.getElementById('channelContainer');
const searchEl = document.getElementById('search');
const categoryEl = document.getElementById('category');
const sortEl = document.getElementById('sort');
const showFavsBtn = document.getElementById('showFavs');
const resetViewBtn = document.getElementById('resetView');
const nowTitle = document.getElementById('nowTitle');
const openNativeBtn = document.getElementById('openNative');
const playInlineBtn = document.getElementById('playInline');
const exportBtn = document.getElementById('exportBtn');
const themeToggle = document.getElementById('themeToggle');

let channels = [];        // tÃ¼m kanallar
let viewList = [];       // ÅŸu an gÃ¶rÃ¼ntÃ¼lenenler
let favorites = JSON.parse(localStorage.getItem('croz_favs') || '[]');
let current = null;      // ÅŸu an oynanan kanal objesi

// helpers
function showChannels(list){
  viewList = list;
  document.getElementById('countLabel').textContent = `${list.length} kanal`;
  if(list.length === 0){
    channelContainer.innerHTML = '<div class="empty">Filtreye uygun kanal bulunamadÄ±.</div>';
    return;
  }
  const grid = document.createElement('div');
  grid.className = 'grid';
  list.forEach((ch, idx) => {
    const c = document.createElement('div');
    c.className = 'channel';
    c.dataset.index = idx;

    // logo
    const logoWrap = document.createElement('div');
    logoWrap.className = 'logo-thumb';
    if(ch.logo){
      const img = document.createElement('img');
      img.src = ch.logo;
      img.alt = ch.name;
      logoWrap.appendChild(img);
    } else {
      logoWrap.innerHTML = `<div style="padding:6px;color:var(--muted);font-size:12px;text-align:center">No Logo</div>`;
    }

    const info = document.createElement('div');
    info.className = 'info';
    info.innerHTML = `<div class="name">${ch.name}</div><div class="meta">${ch.group || ''} â€¢ ${ch.category || 'live'}</div>`;

    const badges = document.createElement('div');
    badges.className = 'badges';

    const fav = document.createElement('span');
    fav.className = 'favorite' + (favorites.includes(ch.name) ? ' active' : '');
    fav.innerHTML = favorites.includes(ch.name) ? 'â¤ï¸' : 'ðŸ¤';
    fav.onclick = (e) => {
      e.stopPropagation();
      toggleFav(ch);
      fav.className = 'favorite' + (favorites.includes(ch.name) ? ' active' : '');
      fav.innerHTML = favorites.includes(ch.name) ? 'â¤ï¸' : 'ðŸ¤';
      renderFavCount();
    };

    badges.appendChild(fav);

    c.appendChild(logoWrap);
    c.appendChild(info);
    c.appendChild(badges);

    // click -> open native player
    c.addEventListener('click', () => {
      playChannel(ch);
    });

    grid.appendChild(c);
  });
  channelContainer.innerHTML = '';
  channelContainer.appendChild(grid);
  renderFavCount();
}

function renderFavCount(){
  showFavsBtn.innerHTML = `<i class="fas fa-heart"></i> Favoriler (${favorites.length})`;
}

function toggleFav(ch){
  if(favorites.includes(ch.name)){
    favorites = favorites.filter(x => x !== ch.name);
  } else {
    favorites.push(ch.name);
  }
  localStorage.setItem('croz_favs', JSON.stringify(favorites));
}

// parsing
function parseM3U(text){
  const lines = text.split(/\r?\n/);
  const result = [];
  let current = null;
  for(const raw of lines){
    const line = raw.trim();
    if(!line) continue;
    if(line.startsWith('#EXTINF:')){
      // parse attrs and name
      current = { name: 'Bilinmeyen', logo: '', group:'', category:'live', raw: line };
      // attrs like: #EXTINF:-1 tvg-id="..." tvg-logo="..." group-title="News",Channel Name
      const attrPart = line.substring(8); // after #EXTINF:
      // try to extract tvg-logo / group-title
      const logoMatch = attrPart.match(/tvg-logo="([^"]+)"/i);
      const groupMatch = attrPart.match(/group-title="([^"]+)"/i);
      if(logoMatch) current.logo = logoMatch[1];
      if(groupMatch) current.group = groupMatch[1];
      // name after last comma
      const nameMatch = line.match(/,(.*)$/);
      if(nameMatch) current.name = nameMatch[1].trim();
      // category guess
      const ln = current.name.toLowerCase();
      if(ln.includes('film')||ln.includes('movie')) current.category='movie';
      else if(ln.includes('dizi')||ln.includes('series')) current.category='series';
      else if(ln.includes('spor')||ln.includes('sport')) current.category='sport';
      else if(ln.includes('mÃ¼zik')||ln.includes('music')) current.category='music';
    } else if(line.startsWith('http') || line.startsWith('rtmp') || line.startsWith('udp://') || line.includes('.ts') || line.includes('.mpg')){
      if(current){
        current.url = line;
        result.push(current);
        current = null;
      } else {
        // sometimes playlists only have urls - add generic
        result.push({ name: line, url: line, logo:'', group:'', category:'live' });
      }
    }
  }
  return result;
}

// file load
fileInput.addEventListener('change', (e) => {
  const f = e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = () => {
    pasteArea.value = reader.result;
  };
  reader.readAsText(f);
});

// parse button
parseBtn.addEventListener('click', () => {
  const content = pasteArea.value.trim();
  if(!content){
    alert('LÃ¼tfen M3U iÃ§eriÄŸini yapÄ±ÅŸtÄ±rÄ±n veya dosya seÃ§in.');
    return;
  }
  channels = parseM3U(content);
  populateCategoryFilter();
  applyView();
});

// clear
clearBtn.addEventListener('click', () => {
  pasteArea.value = '';
  channels = [];
  viewList = [];
  channelContainer.innerHTML = '<div class="empty">HenÃ¼z kanal yok â€” M3U yÃ¼kle veya iÃ§eriÄŸi yapÄ±ÅŸtÄ±rÄ±p "AyrÄ±ÅŸtÄ±r" butonuna bas.</div>';
  document.getElementById('countLabel').textContent = '0 kanal';
});

// filtering & UI
function populateCategoryFilter(){
  const cats = Array.from(new Set(channels.map(c => c.category || 'live'))).sort();
  categoryEl.innerHTML = '<option value="">TÃ¼m Kategoriler</option>';
  for(const c of cats){
    const o = document.createElement('option');
    o.value = c;
    o.textContent = c.charAt(0).toUpperCase()+c.slice(1);
    categoryEl.appendChild(o);
  }
}

function applyView(){
  let list = [...channels];
  const q = searchEl.value.trim().toLowerCase();
  const cat = categoryEl.value;
  if(q) list = list.filter(ch => ch.name.toLowerCase().includes(q));
  if(cat) list = list.filter(ch => (ch.category||'live') === cat);
  if(sortEl.value === 'name') list.sort((a,b) => a.name.localeCompare(b.name));
  if(sortEl.value === 'group') list.sort((a,b) => (a.group||'').localeCompare(b.group||''));
  showChannels(list);
}

searchEl.addEventListener('input', applyView);
categoryEl.addEventListener('change', applyView);
sortEl.addEventListener('change', applyView);

// show only favs
showFavsBtn.addEventListener('click', () => {
  const list = channels.filter(c => favorites.includes(c.name));
  showChannels(list);
});

// reset view
resetViewBtn.addEventListener('click', applyView);

// play channel
function playChannel(ch){
  current = ch;
  nowTitle.textContent = ch.name;
  // set the native open url
  lastStreamUrl = ch.url;
  // set the inline video src (if supported)
  const v = document.getElementById('player');
  // We intentionally don't replace player inline here by default; user chooses.
}

// open native (external)
let lastStreamUrl = null;
openNativeBtn.addEventListener('click', () => {
  if(!lastStreamUrl){ alert('Ã–nce bir kanal seÃ§in.'); return; }
  // open via location -> native player / app will handle if associated
  window.location.href = lastStreamUrl;
});

// play inline (may or may not work depending on format and browser)
playInlineBtn.addEventListener('click', () => {
  if(!lastStreamUrl){ alert('Ã–nce bir kanal seÃ§in.'); return; }
  // Create a temporary video element overlay and attempt to play
  const overlay = document.createElement('div');
  overlay.style.position='fixed';overlay.style.inset='0';overlay.style.background='rgba(0,0,0,0.85)';overlay.style.display='flex';overlay.style.alignItems='center';overlay.style.justifyContent='center';overlay.style.zIndex='9999';
  const vid = document.createElement('video');
  vid.controls = true; vid.autoplay = true; vid.style.width='92%'; vid.style.maxWidth='900px'; vid.style.borderRadius='10px'; vid.style.background='#000';
  const source = document.createElement('source');
  source.src = lastStreamUrl; source.type = 'video/mp2t';
  vid.appendChild(source);
  overlay.appendChild(vid);
  overlay.addEventListener('click', (e)=>{ if(e.target === overlay) document.body.removeChild(overlay); });
  document.body.appendChild(overlay);
  vid.play().catch(err => {
    alert('TarayÄ±cÄ± bu formatÄ± doÄŸrudan oynatamayabilir. LÃ¼tfen "Native AÃ§" butonunu kullanÄ±n.');
    console.error(err);
  });
});

// export playlist (as plain text)
exportBtn.addEventListener('click', () => {
  if(!channels.length){ alert('DÄ±ÅŸa aktarÄ±lacak kanal yok.'); return; }
  let txt = '#EXTM3U\n';
  channels.forEach(c => {
    const attrs = [];
    if(c.logo) attrs.push(`tvg-logo="${c.logo}"`);
    if(c.group) attrs.push(`group-title="${c.group}"`);
    txt += `#EXTINF:-1 ${attrs.join(' ' )},${c.name}\n${c.url}\n`;
  });
  const blob = new Blob([txt], {type:'text/plain;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'croz_playlist_export.m3u';
  a.click();
  URL.revokeObjectURL(a.href);
});

// theme toggle
let dark = true;
themeToggle.addEventListener('click', () => {
  dark = !dark;
  if(!dark){
    document.documentElement.style.setProperty('--bg','#f6f9fc');
    document.documentElement.style.setProperty('--panel','#ffffff');
    document.documentElement.style.setProperty('--card','#ffffff');
    document.documentElement.style.setProperty('--text','#0b1220');
    document.documentElement.style.setProperty('--muted','#536278');
  } else {
    document.documentElement.style.setProperty('--bg','#0b0d10');
    document.documentElement.style.setProperty('--panel','#0f1417');
    document.documentElement.style.setProperty('--card','#101418');
    document.documentElement.style.setProperty('--text','#e6eef6');
    document.documentElement.style.setProperty('--muted','#94a3b8');
  }
});

// init
renderFavCount();
channelContainer.innerHTML = '<div class="empty">HenÃ¼z kanal yok â€” M3U yÃ¼kle veya iÃ§eriÄŸi yapÄ±ÅŸtÄ±rÄ±p "AyrÄ±ÅŸtÄ±r" butonuna bas.</div>';
</script>
</body>
</html>