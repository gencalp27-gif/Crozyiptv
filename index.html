<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Croz IPTV Pro â€” Offline M3U Player</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>TV</text></svg>">
  <meta name="theme-color" content="#e50914">
  <style>
    :root{
      --bg:#0b0d10; --panel:#0f1417; --muted:#94a3b8; --card:#101418;
      --accent:#e50914; --accent-2:#00a8ff; --success:#00d46a; --radius:12px;
      --glass: rgba(255,255,255,0.03); --text:#e6eef6;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    body{background:linear-gradient(180deg,#050607 0%,var(--bg) 100%);color:var(--text); -webkit-font-smoothing:antialiased;}
    .app{max-width:1100px;margin:20px auto;padding:16px;}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px;flex-wrap:wrap;}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#ff7a7a);display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 6px 18px rgba(0,0,0,0.6);}
    .title{font-weight:700;font-size:1.2rem}
    .sub{color:var(--muted);font-size:.85rem;margin-top:2px}

    .controls{display:grid;grid-template-columns:1fr 160px;gap:12px;margin-bottom:14px;}
    @media (max-width:700px){ .controls{grid-template-columns:1fr;} }

    .card{background:var(--panel);border-radius:var(--radius);padding:16px;box-shadow:0 6px 20px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03);}
    .upload-row{display:flex;gap:10px;align-items:center;}
    .input, textarea, select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:var(--glass); color:inherit; font-size:0.95rem; }
    .smallbtn{padding:10px 14px;border-radius:10px;border:none;background:var(--accent);color:#fff;cursor:pointer;display:inline-flex;align-items:center;gap:8px;font-size:0.9rem;}
    .smallbtn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .file-label{cursor:pointer;display:inline-flex;align-items:center;gap:8px;font-weight:600;color:var(--accent)}

    .tools{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:12px;}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:12px;margin-top:14px;}
    @media (max-width:640px){ .grid{grid-template-columns:repeat(2,1fr)} }

    .channel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015)); padding:10px;border-radius:12px;cursor:pointer;display:flex;gap:10px;align-items:center;border:1px solid rgba(255,255,255,0.02);transition:all .16s}
    .channel:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(0,0,0,0.6);border-color:rgba(255,255,255,0.04)}
    .logo-thumb{width:84px;height:56px;border-radius:8px;background:#071018;display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0}
    .logo-thumb img{width:100%;height:100%;object-fit:cover;loading:lazy}
    .info{flex:1;min-width:0}
    .name{font-weight:700;font-size:0.95rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .meta{color:var(--muted);font-size:0.82rem;margin-top:4px}
    .badges{display:flex;gap:8px;align-items:center;margin-left:8px}
    .badge{font-size:0.78rem;padding:5px 8px;border-radius:999px;background:rgba(255,255,255,0.03);color:var(--muted);border:1px solid rgba(255,255,255,0.02)}

    .nowplaying{margin-top:14px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .nowplaying .title{font-weight:700;font-size:0.95rem}
    .actions{display:flex;gap:8px;align-items:center}

    .favorite{font-size:18px;cursor:pointer;color:rgba(255,255,255,0.6)}
    .favorite.active{color:var(--accent)}

    .footer-note{color:var(--muted);font-size:0.82rem;margin-top:16px;text-align:center;line-height:1.5;}
    .empty{padding:28px;border-radius:12px;border:1px dashed rgba(255,255,255,0.03);text-align:center;color:var(--muted);font-size:0.9rem}

    /* PWA Install Button */
    .install-btn{margin-top:12px;text-align:center}
    .install-btn button{background:var(--success);padding:10px 16px;}
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="brand">
      <div class="logo"><i class="fas fa-broadcast-tower"></i></div>
      <div>
        <div class="title">Croz IPTV Pro</div>
        <div class="sub">Offline M3U Player â€¢ Yerel & Native Destek</div>
      </div>
    </div>

    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <button id="themeToggle" class="smallbtn secondary" title="Tema deÄŸiÅŸtir"><i class="fas fa-adjust"></i></button>
      <button id="installBtn" class="smallbtn secondary" style="display:none"><i class="fas fa-mobile-alt"></i> Uygulama YÃ¼kle</button>
      <button id="exportBtn" class="smallbtn" title="Playlist dÄ±ÅŸa aktar"><i class="fas fa-file-export"></i> DÄ±ÅŸa Aktar</button>
    </div>
  </div>

  <!-- controls -->
  <div class="controls">
    <div class="card">
      <div style="font-weight:700;margin-bottom:8px">M3U YÃ¼kle</div>
      <div class="upload-row">
        <label class="file-label" for="fileInput"><i class="fas fa-file-upload"></i> Dosyadan YÃ¼kle</label>
        <input id="fileInput" type="file" accept=".m3u,.m3u8,.txt" style="display:none">
      </div>
      <div style="margin-top:10px">
        <div style="font-weight:600;margin-bottom:6px">veya M3U Ä°Ã§eriÄŸini YapÄ±ÅŸtÄ±r</div>
        <textarea id="pasteArea" class="input" rows="5" placeholder="#EXTM3U ile baÅŸlayan iÃ§eriÄŸi buraya yapÄ±ÅŸtÄ±r..."></textarea>
      </div>
      <div class="tools">
        <button id="parseBtn" class="smallbtn"><i class="fas fa-magnifying-glass"></i> AyrÄ±ÅŸtÄ±r</button>
        <button id="clearBtn" class="smallbtn secondary"><i class="fas fa-trash"></i> Temizle</button>
      </div>
      <div style="margin-top:8px;color:var(--muted);font-size:0.85rem">
        <i class="fas fa-info-circle"></i> Web CORS nedeniyle URL Ã§ekemez. Dosya yÃ¼kle veya iÃ§eriÄŸi yapÄ±ÅŸtÄ±r.
      </div>
    </div>

    <div class="card">
      <div style="font-weight:700">Filtre & Ara</div>
      <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
        <input id="search" class="input" placeholder="Kanal ara..." />
        <select id="category" class="input" style="min-width:140px">
          <option value="">TÃ¼m Kategoriler</option>
        </select>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <select id="sort" class="input" style="min-width:130px">
          <option value="">SÄ±rala</option>
          <option value="name">Ä°sim</option>
          <option value="group">Grup</option>
        </select>
        <button id="showFavs" class="smallbtn secondary"><i class="fas fa-heart"></i> Favoriler</button>
        <button id="resetView" class="smallbtn secondary"><i class="fas fa-list"></i> TÃ¼m</button>
      </div>

      <div class="nowplaying" style="margin-top:12px">
        <div>
          <div style="font-size:0.82rem;color:var(--muted)">Åžu an oynuyor</div>
          <div id="nowTitle" class="title">-</div>
        </div>
        <div class="actions">
          <button id="openNative" class="smallbtn secondary"><i class="fas fa-external-link-alt"></i> Native</button>
          <button id="playInline" class="smallbtn"><i class="fas fa-play"></i> TarayÄ±cÄ±da</button>
        </div>
      </div>
    </div>
  </div>

  <!-- channels -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700">Kanallar</div>
      <div style="color:var(--muted);font-size:0.9rem" id="countLabel">0 kanal</div>
    </div>
    <div id="channelContainer" style="margin-top:12px">
      <div class="empty">M3U yÃ¼kleyip "AyrÄ±ÅŸtÄ±r" butonuna bas.</div>
    </div>
  </div>

  <!-- User Info Footer -->
  <div class="footer-note">
    <strong>@ibrahimgenctr34</strong> â€¢ TÃ¼rkiye <span id="liveTime"></span><br>
    Croz IPTV Pro v2.0 â€” <a href="https://github.com/ibrahimgenctr34/croz-iptv" style="color:var(--accent);text-decoration:none">GitHub</a> â€¢ 
    <a href="https://x.com/ibrahimgenctr34" style="color:var(--accent-2);text-decoration:none">X</a>
  </div>

  <div class="install-btn" id="installPrompt" style="display:none">
    <button id="installAction" class="smallbtn">Croz IPTVâ€™yi Ana Ekrana Ekle</button>
  </div>
</div>

<script>
/* Croz IPTV Pro v2.0 â€” @ibrahimgenctr34 */
const fileInput = document.getElementById('fileInput');
const pasteArea = document.getElementById('pasteArea');
const parseBtn = document.getElementById('parseBtn');
const clearBtn = document.getElementById('clearBtn');
const channelContainer = document.getElementById('channelContainer');
const searchEl = document.getElementById('search');
const categoryEl = document.getElementById('category');
const sortEl = document.getElementById('sort');
const showFavsBtn = document.getElementById('showFavs');
const resetViewBtn = document.getElementById('resetView');
const nowTitle = document.getElementById('nowTitle');
const openNativeBtn = document.getElementById('openNative');
const playInlineBtn = document.getElementById('playInline');
const exportBtn = document.getElementById('exportBtn');
const themeToggle = document.getElementById('themeToggle');
const installBtn = document.getElementById('installBtn');
const installPrompt = document.getElementById('installPrompt');
const installAction = document.getElementById('installAction');
const liveTime = document.getElementById('liveTime');

let channels = [], viewList = [], favorites = JSON.parse(localStorage.getItem('croz_favs_v2') || '[]');
let current = null, lastStreamUrl = null;
let deferredPrompt;

// Live Time (TÃ¼rkiye)
function updateTime() {
  const now = new Date();
  const trTime = now.toLocaleString('tr-TR', { timeZone: 'Europe/Istanbul' });
  liveTime.textContent = `â€¢ ${trTime.split(' ')[1].slice(0,5)}`;
}
updateTime();
setInterval(updateTime, 1000);

// PWA Install
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'inline-flex';
  installPrompt.style.display = 'block';
});
installBtn.onclick = installAction.onclick = () => {
  installPrompt.style.display = 'none';
  deferredPrompt.prompt();
  deferredPrompt.userChoice.then(() => {
    deferredPrompt = null;
  });
};

// Theme Toggle
let dark = true;
themeToggle.addEventListener('click', () => {
  dark = !dark;
  document.documentElement.style.setProperty('--bg', dark ? '#0b0d10' : '#f6f9fc');
  document.documentElement.style.setProperty('--panel', dark ? '#0f1417' : '#ffffff');
  document.documentElement.style.setProperty('--card', dark ? '#101418' : '#ffffff');
  document.documentElement.style.setProperty('--text', dark ? '#e6eef6' : '#0b1220');
  document.documentElement.style.setProperty('--muted', dark ? '#94a3b8' : '#536278');
});

// Parse M3U
function parseM3U(text) {
  const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
  const result = [];
  let current = null;
  for (const line of lines) {
    if (line.startsWith('#EXTINF:')) {
      current = { name: 'Bilinmeyen', logo: '', group: '', category: 'live', url: '' };
      const after = line.substring(8);
      const logoMatch = after.match(/tvg-logo="([^"]+)"/i);
      const groupMatch = after.match(/group-title="([^"]+)"/i);
      if (logoMatch) current.logo = logoMatch[1];
      if (groupMatch) current.group = groupMatch[1];
      const nameMatch = line.match(/,(.*)$/);
      if (nameMatch) current.name = nameMatch[1].trim();

      const lower = current.name.toLowerCase();
      if (lower.includes('film') || lower.includes('movie')) current.category = 'movie';
      else if (lower.includes('dizi') || lower.includes('series')) current.category = 'series';
      else if (lower.includes('spor') || lower.includes('sport')) current.category = 'sport';
      else if (lower.includes('mÃ¼zik') || lower.includes('music')) current.category = 'music';
    } else if ((line.startsWith('http') || line.includes('.m3u8') || line.includes('.ts')) && current) {
      current.url = line;
      result.push(current);
      current = null;
    }
  }
  return result;
}

// File & Parse
fileInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => pasteArea.value = reader.result;
  reader.readAsText(file);
});

parseBtn.addEventListener('click', () => {
  const content = pasteArea.value.trim();
  if (!content) return alert('LÃ¼tfen M3U iÃ§eriÄŸi yapÄ±ÅŸtÄ±rÄ±n veya dosya yÃ¼kleyin.');
  channels = parseM3U(content);
  populateCategoryFilter();
  applyView();
});

clearBtn.addEventListener('click', () => {
  pasteArea.value = ''; channels = []; applyView();
  channelContainer.innerHTML = '<div class="empty">M3U yÃ¼kleyip "AyrÄ±ÅŸtÄ±r" butonuna bas.</div>';
  document.getElementById('countLabel').textContent = '0 kanal';
});

// View & Filters
function populateCategoryFilter() {
  const cats = [...new Set(channels.map(c => c.category))].sort();
  categoryEl.innerHTML = '<option value="">TÃ¼m Kategoriler</option>';
  cats.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c; opt.textContent = c.charAt(0).toUpperCase() + c.slice(1);
    categoryEl.appendChild(opt);
  });
}

function applyView() {
  let list = [...channels];
  const q = searchEl.value.trim().toLowerCase();
  const cat = categoryEl.value;
  if (q) list = list.filter(c => c.name.toLowerCase().includes(q));
  if (cat) list = list.filter(c => c.category === cat);
  if (sortEl.value === 'name') list.sort((a,b) => a.name.localeCompare(b.name));
  if (sortEl.value === 'group') list.sort((a,b) => (a.group||'').localeCompare(b.group||''));
  showChannels(list);
}

searchEl.addEventListener('input', applyView);
categoryEl.addEventListener('change', applyView);
sortEl.addEventListener('change', applyView);
showFavsBtn.addEventListener('click', () => showChannels(channels.filter(c => favorites.includes(c.name))));
resetViewBtn.addEventListener('click', applyView);

// Show Channels
function showChannels(list) {
  viewList = list;
  document.getElementById('countLabel').textContent = `${list.length} kanal`;
  if (!list.length) {
    channelContainer.innerHTML = '<div class="empty">Filtreye uygun kanal yok.</div>';
    return;
  }
  const grid = document.createElement('div'); grid.className = 'grid';
  list.forEach(ch => {
    const c = document.createElement('div'); c.className = 'channel';
    const logo = document.createElement('div'); logo.className = 'logo-thumb';
    if (ch.logo) { const img = new Image(); img.src = ch.logo; img.loading = 'lazy'; logo.appendChild(img); }
    else logo.innerHTML = `<div style="font-size:11px;color:#555">No Logo</div>`;

    const info = document.createElement('div'); info.className = 'info';
    info.innerHTML = `<div class="name">${ch.name}</div><div class="meta">${ch.group || 'Genel'} â€¢ ${ch.category}</div>`;

    const badges = document.createElement('div'); badges.className = 'badges';
    const fav = document.createElement('span'); fav.className = 'favorite' + (favorites.includes(ch.name) ? ' active' : '');
    fav.innerHTML = favorites.includes(ch.name) ? 'â¤ï¸' : 'ðŸ¤';
    fav.onclick = e => { e.stopPropagation(); toggleFav(ch); fav.classList.toggle('active'); fav.innerHTML = favorites.includes(ch.name) ? 'â¤ï¸' : 'ðŸ¤'; };
    badges.appendChild(fav);

    c.append(logo, info, badges);
    c.onclick = () => playChannel(ch);
    grid.appendChild(c);
  });
  channelContainer.innerHTML = ''; channelContainer.appendChild(grid);
}

function toggleFav(ch) {
  if (favorites.includes(ch.name)) favorites = favorites.filter(n => n !== ch.name);
  else favorites.push(ch.name);
  localStorage.setItem('croz_favs_v2', JSON.stringify(favorites));
  showFavsBtn.innerHTML = `<i class="fas fa-heart"></i> Favoriler (${favorites.length})`;
}

// Play
function playChannel(ch) {
  current = ch; lastStreamUrl = ch.url; nowTitle.textContent = ch.name;
}

openNativeBtn.onclick = () => {
  if (!lastStreamUrl) return alert('Kanal seÃ§in.');
  window.location.href = lastStreamUrl;
};

playInlineBtn.onclick = () => {
  if (!lastStreamUrl) return alert('Kanal seÃ§in.');
  const overlay = document.createElement('div');
  overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:9999';
  const vid = document.createElement('video');
  vid.controls = true; vid.autoplay = true; vid.style.cssText = 'width:92%;max-width:900px;border-radius:12px;background:#000';
  vid.innerHTML = `<source src="${lastStreamUrl}" type="video/mp2t">`;
  overlay.appendChild(vid);
  overlay.onclick = e => e.target === overlay && document.body.removeChild(overlay);
  document.body.appendChild(overlay);
  vid.play().catch(() => alert('TarayÄ±cÄ± bu formatÄ± oynatamayabilir. Native AÃ§ kullanÄ±n.'));
};

// Export
exportBtn.onclick = () => {
  if (!channels.length) return alert('DÄ±ÅŸa aktarÄ±lacak kanal yok.');
  let txt = '#EXTM3U\n';
  channels.forEach(c => {
    const attrs = [];
    if (c.logo) attrs.push(`tvg-logo="${c.logo}"`);
    if (c.group) attrs.push(`group-title="${c.group}"`);
    txt += `#EXTINF:-1 ${attrs.join(' ')},${c.name}\n${c.url}\n`;
  });
  const blob = new Blob([txt], {type: 'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'croz_export.m3u';
  a.click();
};

// Init
showFavsBtn.innerHTML = `<i class="fas fa-heart"></i> Favoriler (${favorites.length})`;
applyView();
</script>
</body>
</html>